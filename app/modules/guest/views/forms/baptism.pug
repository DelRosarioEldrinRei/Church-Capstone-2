extends ../../../../templates/guests
block main
    style.
        @media screen and (max-width: 576px) {
            .col-md-4, .col-md-6, .col-md-9 {
                padding-left: 0;
                padding-right: 0;
            }
            .form-wizard-step {
                padding-bottom: 10px !important;
            }
        }
        #header-style-1 {
            background-image: url(/imgchurch/bible2.png)
        }
        .fc-content {
            font-family: sans-serif !important;
        }
    #headers
        #header-style-1
            .container
                .header-caption
                    .row
                        .col-md-12.header-content
                            h3.header-title.animated.fadeInDown.invisible
                                span.text-primary Helium - 
                                | Bootstrap 4 UI Kit
                            h6.header-text.animated.fadeIn.invisible
                                | Lorem ipsum dolor sit amet, consectetuer adipiscing elit<br>Lorem ipsum dolor sit amet, consectetuer.</h6>
                            //- a.page-scroll.btn.btn-lg.btn-default-filled.animated.fadeInUp.invisible(href="#") Download Now
                            //- a.page-scroll.btn.btn-lg.btn-secondary.animated.fadeInUp.invisible.destination(href="#") Explore
    #raised-section.main.main-raised
        section.form-box
            .container
                .row
                    .col-md-12.form-wizard
                            h3 Baptism Application
                            p Fill all form field to go next step
                            // Form progress
                            .form-wizard-steps.form-wizard-tolal-steps-3
                                .form-wizard-progress
                                    .form-wizard-progress-line(data-now-value='12.25' data-number-of-steps='3' style='width: 12.25%;')
                                // Step 1
                                .form-wizard-step.active
                                    .form-wizard-step-icon
                                        i.fa.fa-location-arrow(aria-hidden='true')
                                    p.d-none.d-sm-block Baptism Details
                                // Step 1
                                // Step 2
                                .form-wizard-step
                                    .form-wizard-step-icon
                                        i.fa.fa-user(aria-hidden='true')
                                    p.d-none.d-sm-block Personal Information
                                // Step 2
                                // Step 3
                                .form-wizard-step
                                    .form-wizard-step-icon
                                        i.fa.fa-briefcase(aria-hidden='true')
                                    p.d-none.d-sm-block Sponsors Information
                                // Step 3
                            // Form progress
                            // Form Step 1
                            fieldset
                                h4
                                    .d-none.d-sm-inline.pull-left Baptism Details: 
                                    span Step 1 - 3
                                .form-group
                                    br
                                    h6.label-control.ml-3.mb-0 Baptism Type & Date:
                                    .container
                                        .row
                                            .col-md-3.px-lg-3.px-md-0.px-sm-0
                                                .form-group
                                                    .custom-control.custom-radio.mt-2
                                                        input#radio1.custom-control-input(type='radio', name='baptismtype' value="Regular")
                                                        label.custom-control-label(for='radio1') 
                                                            h6 Regular
                                                    .custom-control.custom-radio
                                                        input#radio2.custom-control-input(type='radio', name='baptismtype' value="Special")
                                                        label.custom-control-label(for='radio2') 
                                                            h6 Special
                                            .col-md-9.px-lg-3.px-md-3.px-sm-0
                                                #regular
                                                    .form-group
                                                        h6.label-control Regular Baptism Date
                                                            .container
                                                                #calendarRegular
                                                #special
                                                    .form-group
                                                        h6.label-control Special Baptism Date
                                                            .container
                                                                #calendarSpecial
                                        .learn-more.pull-right
                                            button.btn.btn-next(type='button') Next
                            // Form Step 1
                            // Form Step 2
                            fieldset
                                h4
                                    .d-none.d-sm-inline Personal Information: 
                                    span Step 2 - 3
                                .form-group
                                    br
                                    input.form-control(type='hidden' name='userID' value=`${user.int_userID}`)
                                    .container
                                        h6.label-control Name of the Child:
                                        .row
                                            .col-md-4.px-lg-3.px-md-0.px-sm-0
                                                .form-group.pt-0
                                                    input.form-control#lastname(type='text' placeholder="Last Name" name='lastname' required='' pattern="[A-Za-z ]{2,}" )
                                                    .help-block.with-errors
                                            .col-md-4.p-lg-0.px-md-3.px-sm-0
                                                .form-group.pt-0
                                                    input.form-control#firstname(type='text' placeholder="First Name" name='firstname' required='' pattern="[A-Za-z ]{2,}" )
                                                    .help-block.with-errors
                                            .col-md-4.px-lg-3.px-md-0.px-sm-0
                                                .form-group.pt-0
                                                    input.form-control#middlename(type='text' placeholder="Middle Name" name='middlename' pattern="[A-Za-z ]{2,}" )
                                                    .help-block.with-errors
                                        .row
                                            .col-md-4.px-lg-3.px-md-0.px-sm-0
                                                .form-group.m-0
                                                    h6.label-control Gender
                                                    .custom-control.custom-radio
                                                        input#customRadio1.custom-control-input(type='radio', name='gender' value="Male" checked)
                                                        label.custom-control-label(for='customRadio1') 
                                                            | Male
                                                    .custom-control.custom-radio
                                                        input#customRadio2.custom-control-input(type='radio', name='gender' value="Female")
                                                        label.custom-control-label(for='customRadio2') 
                                                            | Female

                                            .col-md-4.p-lg-0.px-md-3.px-sm-0
                                                .form-group
                                                    h6.label-control Birthday
                                                    input.birthday.form-control(type='date' name='birthday' required='')
                                            .col-md-4.px-lg-3.px-md-0.px-sm-0
                                                .form-group
                                                    h6.label-control Birthplace:
                                                    input.form-control(type='text' name='birthplace' placeholder="Ex. Payatas, Quezon City" required='' pattern="[A-Za-z0-9 ]{10,}" ) 
                                                    .help-block.with-errors
                                        .row
                                            .col-md-6.px-lg-3.px-md-3.px-sm-0
                                                .form-group
                                                    h6.label-control Father's Full Name:
                                                    input.form-control(type='text' name='fathername' placeholder="Ex. Juan Dela Cruz" required='' pattern="[A-Za-z, ]{2,}" )
                                                    .help-block.with-errors
                                            .col-md-6.px-lg-3.px-md-3.px-sm-0
                                                .form-group
                                                    h6.label-control Father's Birthplace:
                                                    input.form-control(type='text' name='fatherbirthplace' placeholder="Ex. Caloocan, Quezon City" required='' pattern="[A-Za-z, ]{2,}" )
                                                    .help-block.with-errors
                                        .row
                                            .col-md-6.px-lg-3.px-md-3.px-sm-0
                                                .form-group
                                                    h6.label-control Mother's Full name:
                                                    input.form-control(type='text' name='mothername' placeholder="Ex. Maria Dela Cruz" required='' pattern="[A-Za-z, ]{2,}" )
                                                    .help-block.with-errors
                                            .col-md-6.px-lg-3.px-md-3.px-sm-0
                                                .form-group
                                                    h6.label-control Mother's Birthplace:
                                                    input.form-control(type='text' name='motherbirthplace' placeholder="Ex. San Isidro, Quezon City" required='' pattern="[A-Za-z0-9,.- ]{10,}" )
                                                    .help-block.with-errors
                                        .row
                                            .col-md-6.px-lg-3.px-md-3.px-sm-0
                                                .form-group
                                                    h6.label-control Relationship with the Child
                                                    select(type="text" name='relation' required='')
                                                        option(selected="" value="" disabled) Choose...
                                                        option Aunt/Uncle
                                                        option Parent
                                                        option Grandparent
                                                        option Sibling
                                            .col-md-6.px-lg-3.px-md-3.px-sm-0
                                                .form-group
                                                    h6.label-control Family's Contact number
                                                    input#datepicker.form-control(type='text' name='contactnumber' placeholder="Ex. 09123456789" required='' pattern="[0-9]{11}" )
                                        .row
                                            .col-md-6.px-lg-3.px-md-3.px-sm-0
                                                .form-group
                                                    h6(for='exampleFormControlTextarea1') Parents' Marriage Address:
                                                    textarea#exampleFormControlTextarea1.form-control(rows='2' name='marriageaddress' placeholder="Ex. Urban, Bgy. Payatas B 1119 QC" required='' pattern="[A-Za-z0-9,. -]{10,}" )
                                            .col-md-6.px-lg-3.px-md-3.px-sm-0
                                                .form-group
                                                    h6(for='exampleFormControlTextarea1') Family address:
                                                    textarea#exampleFormControlTextarea1.form-control(rows='2' name='address' placeholder="Ex. 75 P. Domingo Street, Carmona, Makati City" required='' pattern="[A-Za-z0-9., -]10,}" )
                                        .row
                                            .col-md-7.px-lg-3.px-md-3.px-sm-0.mx-auto
                                                .form-group
                                                    h6.label-control Birth Certificate
                                                    input#file-0b.file(type='file',accept='image/*',name="image")
                                        .learn-more.pull-right
                                            button.btn.std-btn.btn-secondary.btn-previous.m-0(type='button') Prev
                                            button.btn.btn-next(type='button') Next

                            // Form Step 2
                            // Form Step 3
                            fieldset
                                h4
                                    .d-none.d-sm-inline Sponsors Information:
                                    span Step 3 - 3
                                    h6.label-control Principal Sponsors
                                        .row#principalSponsor
                                            .col-md-6.px-lg-3.px-md-3.px-sm-0
                                                .form-group.m-0
                                                    input.form-control(type='text' name='sponsorname' placeholder="Enter Full Name" required='' pattern="[A-Za-z, ]{2,}" )
                                                    .help-block.with-errors
                                            .col-md-6.px-lg-3.px-md-3.px-sm-0
                                                .form-group.m-0
                                                    input.form-control.balance(type='text' name='sponsorname' placeholder="Enter Full Name" required='' pattern="[A-Za-z, ]{2,}" )
                                        button#addAdditionalSponsor.btn.btn-sm-round.btn-common.btn-fab.btn-fab-mini.btn-round.ml-2.rounded-circle(type="button")
                                            i.fa.fa-plus
                                    h6.label-control Additional Sponsors
                                        .row#additionalSponsor
                                br
                                .learn-more.pull-right
                                    button.btn.std-btn.btn-secondary.btn-previous.m-0(type='button') Prev
                                    button.btn.btn-submit#submitButton(type='button') Submit
    #viewModal.modal.fade(tabindex="-2" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true")
            .modal-dialog.modal-lg(role="document")
                .modal-content
                    .modal-header
                        h5.modal-title Application Request Completed
                        button.close(type='button', data-dismiss='modal', aria-label='Close')
                            span.p-3(aria-hidden='true') ×
                    .modal-body
                        .col-md-12.px-lg-3.px-md-3.px-sm-0
                            .form-group.m-0
                                p Your application request has been submitted. To complete the application process, you must pay on or before the deadline.
                        .col-md-6.px-lg-3.px-md-3.px-sm-0
                            .form-group.m-0
                                label.label-control Deadline of payment
                                | August 27, 2018
                        .col-md-6.px-lg-3.px-md-3.px-sm-0
                            .form-group.m-0
                                label.label-control Application Fee: 
                                | P300.00
                        .col-md-6.px-lg-3.px-md-3.px-sm-0
                            .form-group.m-0
                                label.label-control Voucher
                                    a(href=`/guest/voucher` style= 'margin-left: 3px; color: red' target="_blank" ) Click here to save and print voucher
                    .modal-footer
                        button.btn.std-btn.btn-common.m-0#cancelButton(type='button', data-dismiss='modal') Close
                        button.btn.std-btn.btn-common.btn-info.mb-0#submit2Button(type='submit') Apply
                        //- button.btn.btn-outline.btn-secondary.pull-left#cancelButton(type='button', data-dismiss='modal') Close
                        //- button.btn.btn-submit#submitButton(type='submit') Proceed
                            // Form Step 3
                        // Form Wizard
block addjs
    script.
        $('#textarea1').hide();
        $('#textarea2').hide();
        $('#radioup').click(function() {
            $('#textarea1').slideUp();
            $('#textarea2').slideUp();
        });
        $('#exampleRadios1').click(function() {
            $('#textarea1').slideDown();
            $('#textarea2').slideUp();
        });
        $('#exampleRadios3').click(function() {
            $('#textarea1').slideUp();
            $('#textarea2').slideDown();
        });
        
        $('#regular').hide();
        $('#special').hide();

        $('#radio1').click(function() {
            $('#regular').slideDown();
            $('#special').slideUp();
        });
        $('#radio2').click(function() {
            $('#special').slideDown();
            $('#regular').slideUp();
        });
        $('#submitButton').click(function() {
            $('#viewModal').modal('show');
            
        });
        $("#addPrincipalSponsor").click(function(event){
                var principal = "<div class='col-md-6 mb-4 pb-3'><div class='input-group'><input type='text' name='sponsorname' class='form-control' required /><div class='input-group-prepend'><span class='btnDelete p-1 input-group-text rounded'><i class='fa fa-trash'></i></span></div></div></div>"
                $(principal).hide().appendTo("#principalSponsor").fadeIn(500);
        });
        $("#principalSponsor").on("click", ".btnDelete", function(event){
            $(this).parent().parent().parent().fadeOut(500, function(){
                $(this).remove();
            });
            event.stopPropagation();
        });
        $("#addAdditionalSponsor").click(function(event){
                var item2 = `
                <div class="col-md-6 px-lg-3 px-md-3 px-sm-0 mt-3">
                    <div class="input-group m-0">
                        <input class="form-control" type="text" name="sponsorname" placeholder="Enter Full Name"/>
                        <div class="input-group-prepend">
                            <span class="btnDelete p-1 input-group-text rounded">
                                <i class="fa fa-trash"></i>
                            </span>
                        </div>
                    </div>
                </div>`
                $(item2).hide().appendTo("#additionalSponsor").fadeIn(500);
        });

        $("#additionalSponsor").on("click", ".btnDelete", function(event){
            $(this).parent().parent().parent().fadeOut(500, function(){
                $(this).remove();
            });
            event.stopPropagation();
        });

        // for Regular Baptism Date
        let startDate = moment().add(13, 'days')
        let endDate = moment().add(91, 'days')

        $('.regularBaptism').datetimepicker({
            format: 'YYYY-MM-DD',
            minDate: startDate,
            maxDate: endDate,
            daysOfWeekDisabled: [1,2,3,4,5,6],
            icons: {
                time: "fa fa-clock-o",
                date: "fa fa-calendar",
                up: "fa fa-chevron-up",
                down: "fa fa-chevron-down",
                previous: 'fa fa-chevron-left',
                next: 'fa fa-chevron-right',
                today: 'fa fa-screenshot',
                clear: 'fa fa-trash',
                close: 'fa fa-remove',
            },
        });
    script.
        var eventDate;
        var timeStart;
        var timeEnd2;
        var dateNow1 = new Date()
        var dateNow2 = dateNow1.getFullYear()+'-'+(dateNow1.getMonth()+1)+'-'+dateNow1.getDate();

        $.get('/guest/baptism/query').done(data=>{
            for(i=0;i<data.length;i++){
            var dateEvent = moment(data[i].date_approvedstart).format('MM/DD/YYYY');
            console.log(dateEvent)
                $('#calendarSpecial').fullCalendar('renderEvent', {
                title: 'OCCUPIED EVENT',
                start: `${dateEvent} ${data[i].time_approvedstart}`,
                end: `${dateEvent} ${data[i].time_approvedend}`,
                allDay: false,
                color:'#00ff00'
                });
                console.log('MGA RESERVED')
                console.log(dateEvent)
                console.log(data[i].time_approvedstart)
                console.log(data[i].time_approvedend)
            }
        })
        $('#calendarSpecial').fullCalendar({
            header: {
                left: 'title',
                center: 'agendaDay,month',
                right: 'prev,next today'
            },
            editable: false,
            firstDay: 0,
            selectable: true,
            defaultView: 'month',
            allDaySlot: false,
            selectHelper: true,
            minTime:'8:00:00',
            maxTime:'17:00:00',
            validRange: {
                start: dateNow2
            },
            dayClick: function(date, jsEvent, view) {
                if(view.name == 'agendaDay'){
                    eventDate = date.format('YYYY-MM-DD')
                    timeStart = date.format('hh:mm a')
                    timeEnd1 = date.add(1,'hour').format('YYYY-MM-DD hh:mm a')
                    timeEnd2 = moment(timeEnd1).format('hh:mm a')
                    console.log(eventDate)
                    console.log(timeStart)
                    console.log(timeEnd2)
                    swal({
                        title: 'You have selected this date, are you sure?',
                        html: `Date: ${eventDate}  <br>` +
                        `Time Start: ${timeStart} <br>` +
                        `Time End: ${timeEnd2} <br>`,
                        showCancelButton: true,
                        confirmButtonColor: '#3085d6',
                        cancelButtonColor: '#d33',
                        confirmButtonClass: 'btn btn-success',
                        cancelButtonClass: 'btn btn-danger',
                        buttonsStyling: true,   
                    }).then((value) => {
                        if (value.value) {
                            $("#calendarSpecial").fullCalendar('removeEvents',[1])
                            
                            swal(
                                'Sucess!',
                                'Event Date has been set.',
                                'success'
                            ).then((value)=>{
                            console.log('DESIRED TIME')
                            $('#calendarSpecial').fullCalendar('renderEvent', {
                                title: 'YOUR DESIRED TIME',
                                start: `${moment(eventDate,'YYYY-MM-DD').format('MM/DD/YYYY')} ${timeStart}`,
                                end: `${moment(eventDate,'YYYY-MM-DD').format('MM/DD/YYYY')} ${timeEnd2}`,
                                allDay: false,
                                id:1,
                                overlap: false,
                                draggable:true
                            });
                            return value
                            })
                        } else if (
                            value.dismiss === swal.DismissReason.cancel
                        ) {
                            eventDate = '';
                            timeStart = '';
                            timeEnd2 = '';
                            console.log(eventDate)
                            console.log(timeStart)
                            console.log(timeEnd2)
                        }
                    })
                }
                else if(view.name == 'month'){
                    $('#calendarSpecial').fullCalendar('changeView', 'agendaDay')
                    $('#calendarSpecial').fullCalendar('gotoDate', date);
                }
                else{
                    return  
                }
            },
            droppable: false,
        });
        console.log(eventDate)
        console.log(timeStart)
        console.log(timeEnd2)
        var calendar =  $('#calendarRegular').fullCalendar({
            header: {
                left: 'title',
                center: 'agendaDay,month',
                right: 'prev,next today'
            },
            editable: false,
            firstDay: 0,
            selectable: true,
            defaultView: 'month',
            allDaySlot: false,
            selectHelper: true,
            });
        
