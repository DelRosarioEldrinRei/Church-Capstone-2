extends ../../../../templates/guests
block nav
	#headers
		#header-style-1
			nav.navbar.navbar-expand-lg.fixed-top.scrolling-navbar.indigo
				.container
					.navbar-header
						.slicknav_menu
							liner.slicknav_btn.slicknav_collapsed(aria-haspopup='true', tabindex='0', style='outline: none;')
								span.slicknav_menutxt
								span.slicknav_icon.slicknav_no-text
									span.slicknav_icon-bar
									span.slicknav_icon-bar
									span.slicknav_icon-bar
							ul.slicknav_nav.slicknav_hidden(aria-hidden='true', role='menu', style='display: none;')
								li
									a.page-scroll(href='#sliders', role='menuitem', tabindex='-1')
										| Home
								li
									a.page-scroll(href='#about', role='menuitem', tabindex='-1')
										| About
								li
								li.page-scroll.dropdown
									a.nav-link.dropdown-toggle(href='#', data-toggle='dropdown', aria-haspopup='true', aria-expanded='false') My Account
									.dropdown-menu
										a.dropdown-item.te(href='#') My Profile
										a.dropdown-item(href='#') Messages
										a.dropdown-item(href='#') Notification
										a.dropdown-item(href='/guest/reservation') Reservations
										hr
										a.dropdown-item(href='/logout') Logout
						button.navbar-toggler(type='button', data-toggle='collapse', data-target='#main-navbar', aria-controls='main-navbar', aria-expanded='false', aria-label='Toggle navigation')
							span.navbar-toggler-icon
							span.icon-menu
							span.icon-menu
							span.icon-menu
						a.navbar-brand(href='')
							img(src='/Helium/img/logo.png', alt='')
					#main-navbar.collapse.navbar-collapse
						ul.navbar-nav.mr-auto.w-100.justify-content-end.clearfix
							li.nav-item
								a.nav-link(href='#sliders')
									| Home
							li.nav-item
								a.nav-link(href='#about')
									| About
							li.nav-item.dropdown
								a.nav-link.dropdown-toggle(href='#', data-toggle='dropdown', aria-haspopup='true', aria-expanded='false') My Account
								.dropdown-menu
									a.dropdown-item(href='#') My Profile
									a.dropdown-item(href='#') Messages
									a.dropdown-item(href='#') Notification
									a.dropdown-item(href='/guest/reservation') Reservations
									hr
									a.dropdown-item(href='/logout') Logout
				ul.mobile-menu.navbar-nav
					li.active
						a.page-scroll(href='#sliders')
							| Home		
					li
						a.page-scroll(href='#about')
							| About
					li.dropdown
						a.nav-link.page-scroll.dropdown-toggle(href='#', data-toggle='dropdown', aria-haspopup='true', aria-expanded='false') My Account
						.dropdown-menu
							a.dropdown-item(href='#') My Profile
							a.dropdown-item(href='#') Messages
							a.dropdown-item(href='#') Notification
							a.dropdown-item(href='/guest/reservation') Reservations
							hr
							a.dropdown-item(href='/logout') Logout
			.container
				.header-caption
					.row
						.col-md-12.header-content
							h3.header-title.animated.fadeInDown.invisible
								span.text-primary Helium - 
								| Bootstrap 4 UI Kit
							h5.header-text.animated.fadeIn.invisible
								| Lorem ipsum dolor sit amet, consectetuer adipiscing elit<br>Lorem ipsum dolor sit amet, consectetuer.</h5>
					
block main
	#raised-section.main.main-raised
		.container
			.row
				.col-md-12
					hr.mt-5.mx-5
			.row
				.col-md-12.my-3
					h3.text-center.text-uppercase.mb-5 Request Form
			.row
				.col-md-10.my-auto.mx-auto
					.row
						.col-md-6
							.form-group
								h5.label-control Document
									br
									select#documenttype(type="text" name='documenttype')
										option Baptismal Certificate
										option Confirmation Certificate
										option First Communion Certificate
						.col-md-6
							h5.label-control Event Date
							input#eventDate.datepicker.form-control(type='date' name='start')
					.row
						.col-md-12
							h5.label-control Person in the Certificate:
					.row
						.col-md-6.my-3
							input#lastName.form-control(type='text' name='lastname' placeholder='Last name')
						.col-md-6.my-3
							input#firstName.form-control(type='text' name='firstname' placeholder='First name')
					.row
						.col-md-12.my-3
							.form-group
								h5(for='exampleFormControlTextarea1') Purpose:
								textarea#purpose.form-control(rows='3' name= 'purpose')
					.form-group
						.file-loading
							.learn-more
								input#file-0b.file(type='file',accept='image/*',name="image")
					.row
						.col-md-12.my-5.text-center
							.learn-more
								button.btn.std-btn.btn-common#submit(type='button') Submit
block addjs
	script.
		$(document).ready(function(){
			$("#file-0b").fileinput();
			$('#submit').click(function(){
			var eventDate = moment($('#eventDate').val()).format('YYYY-MM-DD');
				$.post('/guest/document/form/query',{
				eventDate:eventDate,
				firstName:$('#firstName').val(),
				lastName:$('#lastName').val(),
				documentType:$('#documenttype').val(),
					}).done(data=>{
					var fnInput = $('#lastname').val() + ', ' + $('#firstname').val();
					var documentType = $('#documenttype').val();
					var fnValidate = data.var_doclastname + ', ' + data.var_docfirstname;
					if(data){
					var formData = new FormData();
					formData.append('documenttype', $('#documenttype').val())
					formData.append('image', $('#file-0b')[0].files[0]);
					formData.append('lastname', $('#lastName').val())
					formData.append('firstname', $('#firstName').val())
					formData.append('eventDate', $('#eventDate').val())
					formData.append('purpose', $('#purpose').val())
					$.ajax({
						type:'POST',
						url:'/guest/document/form',
						data: formData,
						processData:false,
						contentType:false,
						success: function(data){
							swal({
								title:'Record found!',
								text:'Please wait for 3 days or your request t e processed. We will send you an emil once it is ready to be released. You may also be ',
								icon:'success',
								buttons: {
									Okay: 'okay'
								}
							}).then((value)=>{
								window.location='/guest'
							})
						}
					})
					}
					else{
							swal({
								title:'Sorry but your transaction did not exist',
								icon:'warning',
								buttons: {
									Okay: 'okay'
								}
							}).then((value)=>{
								window.location='/guest/document/form'
							})
						
					}
				})
				})
		})
		
