extends ../../../../templates/guests
block main
	#headers
		#header-style-1
			.container
				.header-caption
					.row
						.col-md-12.header-content
							h3.header-title.animated.fadeInDown.invisible
								span.text-primary Helium - 
								| Bootstrap 4 UI Kit
							h6.header-text.animated.fadeIn.invisible
								| Lorem ipsum dolor sit amet, consectetuer adipiscing elit<br>Lorem ipsum dolor sit amet, consectetuer.</h6>
							//- a.page-scroll.btn.btn-lg.btn-default-filled.animated.fadeInUp.invisible(href="#") Download Now
							//- a.page-scroll.btn.btn-lg.btn-secondary.animated.fadeInUp.invisible(href="#") Explore
	#raised-section.main.main-raised
		section.form-box
			.container
				.row
					.col-md-12.form-wizard
						h3 Request Form
						p Fill all form fields
		.container
			.row
				.col-md-10.my-auto.mx-auto
						label=results
						.row
							.col-md-6
								.form-group
									h5.label-control Document
										br
										select#documenttype(type="text" name='documenttype')
											option Baptismal Certificate
											option Confirmation Certificate
											option First Communion Certificate
							.col-md-6
								h5.label-control Event Date
								input#eventDate.datepicker.form-control(type='date' name='birthday' value=`${results.eventDate}`)
						.row
							.col-md-12
								h5.label-control Person in the Certificate:
						.row
							.col-md-6.my-3
								input#lastName.form-control(type='text' name='lastname' placeholder='Last Name' value=`${results.lastName}`)
							.col-md-6.my-3
								input#firstName.form-control(type='text' name='firstname' placeholder='First Name' value=`${results.firstName}`)
						.row
							.col-md-12.my-3
								.form-group
									h5(for='exampleFormControlTextarea1') Purpose:
									textarea#purpose.form-control(rows='3' name= 'purpose' placeholder='Your purpose for availing the document')
						.row
							.col-md-12
							.col-md-6.px-lg-3.px-md-3.px-sm-0
								.form-group
									h6.label-control Valid ID
									input#file-0b.file(type='file',accept='image/*',name="image")
						.row
							.col-md-12.my-5.text-center
								.learn-more
									button.btn.std-btn.btn-common#submit(type='button') Submit
	block addjs
		script.
			$(document).ready(function(){
				$("#file-0b").fileinput();
				$('#submit').click(function(){
				var eventDate = moment($('#eventDate').val()).format('YYYY-MM-DD');
					$.post('/guest/document/query',{
					eventDate:eventDate,
					firstName:$('#firstName').val(),
					lastName:$('#lastName').val(),
					documentType:$('#documenttype').val(),
					}).done(data=>{
						if(($('#lastName').val() == data.var_lname) && ($('#firstName').val() == data.var_fname) && (eventDate == data.date_approveddate)){
						var formData = new FormData();
						formData.append('documenttype', $('#documenttype').val())
						formData.append('image', $('#file-0b')[0].files[0]);
						formData.append('lastname', $('#lastName').val())
						formData.append('firstname', $('#firstName').val())
						formData.append('eventDate', $('#eventDate').val())
						formData.append('purpose', $('#purpose').val())
						$.ajax({
							type:'POST',
							url:'/guest/document/form',
							data: formData,
							processData:false,
							contentType:false,
							success: function(data){
								swal({
									title:'Record found!',
									text:'Please wait for 3 days for your request to be processed. We will send you an email once it is ready to be released. You may also be ',
									icon:'success',
									buttons: {
										Okay: 'okay'
									}
								}).then((value)=>{
									window.location='/guest'
								})
							}
						})
						}
						else{
								swal({
									title:'Sorry',
									text: 'Your transaction does not exist. Check the data you have entered and try again.',
									icon:'warning',
									buttons: {
										Okay: 'okay'
									}
								}).then((value)=>{
									window.location='/guest/document/form'
								})
							
						}
					})
					})
			})