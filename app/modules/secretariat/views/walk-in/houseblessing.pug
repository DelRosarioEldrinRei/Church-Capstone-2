extends ../../../../templates/secretariat
block prepend main
	style.
			.fa {
				font-size: 25px !important;
			}
			.fa-check::before {
				color: #28a745 !important;
			}
			.fa-times::before {
				color: red !important;
			}
			small {
				font-size: 90% !important;
			}
	main.bgc-grey-100
		#mainContent
			.row.masonry.pos-r
				.masonry-sizer.col-md-12
				.masonry-item.col-md-12
					.bgc-white.p-20.bd
						h6.c-grey-900 Anointing of the Sick
						.mT-30
							form
								.row
									.col-md-6
										.form-group
											label Schedule Date
												.text-danger.d-inline  *
											input.form-control.start-date(id='desireddate' name='desireddate' type='text', placeholder='Enter Desired Date', data-provide='datepicker')
									.col-md-6
										.form-group
											label  Schedule Time
											input.form-control(id='desiredtime' name='desireddate' type='text' placeholder='10:00 am')
								.row
									.col-md-4
										.form-group
											label Name of the Ill
												.text-danger.d-inline  *
											input.form-control(id='lname' name='lname' type='text' placeholder='Last Name *')
									.col-md-4
										.form-group
											label(style='visibility:hidden;') First Name
											input.form-control(id='fname' name='fname' type='text' placeholder='First Name *')
									.col-md-4
										.form-group
											label(style='visibility:hidden;') Middle Name
											input.form-control(id='mname' name='mname' type='text' placeholder='Middle Name')
								.row
									
									.col-md-3.px-lg-3.px-md-3.px-sm-0
											.form-group.m-0.p-0
												h6.label-control Gender
													.text-danger.d-inline  *
												.custom-control.custom-radio
													input#gendermale.custom-control-input(type='radio', name='gender' value="Male"  checked)
													label.custom-control-label(for='gendermale') 
														label Male
												.custom-control.custom-radio
													input#genderfemale.custom-control-input(type='radio', name='gender' value="Female")
													label.custom-control-label(for='genderfemale') 
														label Female
									.col-md-3
										.form-group
											label Birthday
												.text-danger.d-inline  *
											input.form-control.start-date(id='bday' name='bday' type='text', data-provide='datepicker' placeholder='Enter Your Birthday')
									.col-md-6
										.form-group
											label Birthplace
											.text-danger.d-inline  *
											input.form-control(id='bplace' name='bplace' type='text' placeholder='Ex. Payatas, Quezon City')
								.row
									
									.col-md-12
										.form-group
											label Address
												.text-danger.d-inline  *
											input.form-control(id='address' name='address' type='textarea' placeholder='Ex. Urban, Bgy. Payatas B 1119 QC')
								.row
									.col-md-6
										.form-group
											label Place where the blessing will happen
												.text-danger.d-inline  *
											.form-check
												label.form-check-label
													input.form-check-input(id='place1' name='place' type='radio' value='Male' checked='') 
													| Same as his/her address
											.form-check
												label.form-check-label
													input.form-check-input(id='place2' name='place' type='radio' value='Male') 
													| Hospital/Center
												input.form-control(id='hospitalname' name='hospitalname' type='text' placeholder="Please enter the room number, the hospital name & address")
											.form-check
												label.form-check-label
													input.form-check-input(id='place3' name='place' type='radio' value='Male') 
													| Other
												input.form-control(id='othervenue' name='othervenue' type='text' placeholder="Please enter complete address")
									.col-md-6
										.form-group
											label Details
												.text-danger.d-inline  *
											input.form-control(id='details' name='details' type='textarea' placeholder="Please enter his/her illness or the reason of the anointing. (Ex. Operation/Surgery)")
								//- .row
								//- 	.col-md-4
								//- 		#cabinetdiv.form-group
								//- 		label
								//- 			| Cabinet
								//- 			select#cabinets.form-control(onchange='setcabinet(value);')
								//- 			each cabinet in cabinets
								//- 				option(value=`${cabinet.var_cabinetname}`)=cabinet.var_cabinetname
											
											
								//- 	.col-md-4
								//- 		.form-group
								//- 		label
								//- 			| Division
								//- 			select#divisions.form-control(onchange='setdivision(value);')
								//- 			option  No division selected
								//- 	.col-md-4
								//- 		.form-group
								//- 		label
								//- 			| Folder Number
								//- 			input#folderID.form-control(type='text', placeholder='No folder ID yet')

								.text-center
									button.btn.btn-primary#submitApplication(type='button') Submit
							input#errChecker(type='text' hidden)
block addjs
	script.
		// Place where the blessing will happen logic
		$('#hospitalname').hide();
		$('#othervenue').hide();

		$('#place1').click(function() {
			$('#hospitalname').slideUp();
			$('#othervenue').slideUp();
		});
		$('#place2').click(function() {
			$('#hospitalname').slideDown();
			$('#othervenue').slideUp();
		});
		$('#place3').click(function() {
			$('#hospitalname').slideUp();
			$('#othervenue').slideDown();
		});

		$('#desiredtime').datetimepicker({
				format: 'LT',
				icons: {
					time: "fa fa-clock-o",
					date: "fa fa-calendar",
					up: "fa fa-chevron-up",
					down: "fa fa-chevron-down",
					previous: 'fa fa-chevron-left',
					next: 'fa fa-chevron-right',
					today: 'fa fa-screenshot',
					clear: 'fa fa-trash',
					close: 'fa fa-remove'
				}
		});
		//Realtime Validation
		function validateForm(){
			$('form').formValidation({
				framework: 'bootstrap',
				icon: {
					valid: 'fa fa-check',
					invalid: 'fa fa-times',
					validating: 'fa fa-spinner'
				},
				fields: {
					desireddate: {
						validators: {
								notEmpty: {
										message: `Please Enter Your Desired Date`
								}
						}
					},
					lname: {
						validators: {
								notEmpty: {
										message: `Please Enter Your Last Name`
								}
						}
					},
					fname: {
						validators: {
								notEmpty: {
										message: `Please Enter Your First Name`
								}
						}
					},
					
					bday: {
						validators: {
								notEmpty: {
										message: `Please Enter Your Birthday`
								}
						}
					},
					bplace: {
						validators: {
								notEmpty: {
										message: `Please Enter Your Birthplace`
								}
						}
					},
					address: {
						validators: {
								notEmpty: {
										message: `Please Enter Your Address`
								}
						}
					},
					details: {
						validators: {
								notEmpty: {
										message: `Please Enter Your Details`
								}
						}
					},
					
				},
			})
			.on('err.field.fv', function(e, data) {
				// Get the first invalid field
				var invalidFields = data.fv.getInvalidFields().length;
				$('#errChecker').val(invalidFields)
			})
			.on('success.field.fv', function(e, data) {
				// Get the first invalid field
				var invalidFields = data.fv.getInvalidFields().length;
				$('#errChecker').val(invalidFields)
			});
		}

		$(document).ready(function() {
			validateForm()
			
			$('#submitApplication').click(function(){
				console.log('SUBMIT BUTTON CLICKED')
				swal({
				title:'Are you sure?', 
				text:'This record will be considered as an approved request, and will then be added to the schedule of the priest. We will wait for the confirmation of the priest.',
				type:'warning',
				showCancelButton: false,
				confirmButtonColor: '#3085d6',
				cancelButtonColor: '#d33',
				confirmButtonText: 'Confirm'
				}).then((result)=>{
					if(result.value){
						if($('#gendermale').prop("checked")){
							gender= $('#gendermale').val()
						}
						if($('#genderfemale').prop("checked")){
							gender= $('#genderfemale').val()
						}
						if($('#place1').prop("checked")){
							venue= $('#address').val()
						}
						if($("#place2").prop("checked")){
							venue= $('#hospitalname').val()
						}
						if($("#place3").prop("checked")){
							venue= $('#othervenue').val()
						}
						$.post('/secretariat/walkin-anointing', {
							desireddate:$('#desireddate').val(),
							desiredtime:$('#desiredtime').val(),
							lastname: $('#lname').val(),
							firstname: $('#fname').val(),
							middlename: $('#mname').val(),
							birthday: $('#bday').val(),
							gender:gender,
							birthplace: $('#bplace').val(),
							address: $('#address').val(),
							venue: venue,
							details: $('#details').val(),
						}).done(data =>{
							swal({
							title:'Success',
							text:'Request added', 
							type:'success'
							}).then(function(){
								location.reload();
							})
							$('#updateModal').modal('hide');
							$('#updateAppend').empty();
							
						})//done
					}
				})
			})


		

		});//documentready