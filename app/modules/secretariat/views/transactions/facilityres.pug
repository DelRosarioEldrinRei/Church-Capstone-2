extends ../../../../templates/secretariat

block prepend main
	style.
		.tableModal {
		font-family: arial, sans-serif;
		border-collapse: collapse;
		width: 100%;
		}

		.tdModal{
			border: 2px solid #dddddd;
			text-align: left;
			padding: 12px;
		}
	.content
		.container-fluid
			.row
				.col-lg-12.col-md-12
					// Tab panes
					.tab-content
						#nonwedding.tab-pane.active.mx-3
							br
							.tab-content
								#regularbaptism.tab-pane.active
									br
									.card.shadow
											.card-header.card-header-primary
													h4.card-title Facility Reservation
											.card-body.table-responsive
													table.dataTable.table.table-hover
															thead.text-primary
																	//- th ResID
																	th Reserved by
																	th Reserved From
																	th Reserved Until
																	th Status
																	th.text-center(style=" width:120px") Actions
															tbody
																	each reservation in reservations
																		tr
																			//- td=reservation.int_reservationID
																			td=reservation.var_userlname + ", " + reservation.var_userfname
																			td=reservation.datetime_reservestart
																			td=reservation.datetime_reserveend 
																			td=reservation.char_reservestatus
											
																			td.td-actions.text-center
																				button.btn.btn-primary.actionButton(type='button' value=`${reservation.int_reservationID}`)
																					i.ti-settings
																						#toolbar-options.hidden
																							a.viewButton(href='#')
																								i.ti-new-window(style="color:white;")
																							a.updateButton(href='#')
																								i.ti-pencil(style="color:white;")
							  
	#updateModal.modal.fade(tabindex="-2" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true")
		.modal-dialog.modal-lg(role="document")
			.modal-content
				.modal-header
					h5.modal-title Update Event Application
					button.close(type='button', data-dismiss='modal', aria-label='Close')
						span(aria-hidden='true') ×
				.modal-body#updateBodyAppend
				.modal-footer
					button.btn.btn-outline.btn-secondary.pull-left#cancelButton(type='button', data-dismiss='modal') Close
					button.btn.btn-primary#updateSubmitButton(type="button") Update
	#viewModal.modal.fade(tabindex="-2" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true")
			.modal-dialog.modal-lg(role="document")
				.modal-content
					.modal-header
						h4.modal-title View Baptism
						button.close(type='button', data-dismiss='modal', aria-label='Close')
							span(aria-hidden='true') ×
					.modal-body#viewBodyAppend
					//- .modal-footer
					//-     button.btn.btn-outline.btn-secondary.pull-left#cancelButton(type='button', data-dismiss='modal') Close
	#myModal.modal(tabindex='-1', role='dialog', aria-labelledby='exampleModalLabel', aria-hidden='true')
		button.close(type='button', data-dismiss='modal', aria-label='Close')
			span(aria-hidden='true') ×
		img.modal-content1#imgReq
block addjs
	
	script.
		$(document).ready(function(){
			var idNow;
			$('.actionButton').click(function(){
				idNow = $(this).val();
				console.log(idNow)
			})
			$('.viewButton').click(function(){
				console.log(idNow)
				$.post('/secretariat/transaction-facilityreservation/query',{id:idNow}).done(data =>{
					var start = moment(data.datetime_reservestart).format('MM/DD/YYYY hh:mm A')
					var to = moment(data.datetime_reserveend).format('MM/DD/YYYY hh:mm A')
					//- var age = moment().diff(data.date_birthday,'years');
					$('#viewBodyAppend').append(`
					<table class="tableModal">
						<tr>
							<td class="tdModal h5"><strong> Reserved From: </strong> ${start}</td>
							<td class="tdModal h5"><strong> Reserved Until:  </strong> ${to}</td>
						</tr>
						<tr>
							<td class="tdModal h5"><strong> Reserved From: </strong> ${data.var_event}</td>
							<td class="tdModal h5"><strong> Reserved Until:  </strong> ${data.var_eventdesc}</td>
						</tr>
					`)
					$('#viewModal').modal('show')
					$('#viewModal').on('hidden.bs.modal',function(){
						$('#viewBodyAppend').empty()
					})
					$('#myImg').click(function(){
						$('#myModal').modal('show');
						$("#imgReq").attr("src",`${data.var_reqpath}`);
					});

				})
			})
			$('.updateButton').click(function(){
				console.log(idNow)
				$.post('/secretariat/transaction-facilityreservation/query/update',{id:idNow}).done(data =>{
					$('#updateBodyAppend').append(`
					<col-md-4 class="p-lg-0">
						<div class="row">
						<div class="col-md-6">
							<div class="form-group">
							<input id="eventid" type="hidden" value="${data.int_reservationID}"></input>
							<input id="eventstatus" type="hidden" value="${data.char_reservestatus}"></input>
							<h6 class="label-control"><strong> Current Reservation Status : </strong> ${data.char_reservestatus}</h6>
						</div>
						</div>
						</div>
						<div class="row">
						<div class="col-md-6">
							<div class="form-group">
							<input id="reqid" type="hidden" value="${data.int_requirementsfacilityID}"></input>
							<h6 class="label-control"><strong> Current Requirement Status : </strong> ${data.char_reqstatus}</h6>
							<select id="reqstatus" type="text">
							</select>
							</div>
						</div>
						</div>
						</div>
					`)
					$('#updateModal').modal('show')
					$('#updateModal').on('hidden.bs.modal',function(){
						$('#updateBodyAppend').empty()
					})
					if(data.char_paymentstatus == "Paid"){
					$('#paystatus').append(`
					<option selected="selected">Paid</option>
					<option>Unpaid</option>
					`)
					}
					else if(data.char_paymentstatus == "Unpaid"){
					$('#paystatus').append(`
					<option>Paid</option>
					<option selected="selected">Unpaid</option>
					`)
					}
					if(data.var_reqstatus == "Submitted"){
					$('#reqstatus').append(`
					<option selected="selected">Submitted</option>
					<option>Approved</option>
					`)
					}
					else if(data.var_reqstatus == "Approved"){
					$('#reqstatus').append(`
					<option>Submitted</option>
					<option selected="selected">Approved</option>
					`)
					}
					if(data.var_reqstatus == "Approved" && data.char_paymentstatus == "Paid"){
						document.getElementById("paystatus").disabled=true;
						document.getElementById("reqstatus").disabled=true;
					}
					$('#updateSubmitButton').click(function(){
						swal({
						title:'Are You Sure?', 
						text:'You want to update the Status of the Request?', 
						type:'warning',
						showCancelButton: true,
						confirmButtonColor: '#3085d6',
						cancelButtonColor: '#d33',
						confirmButtonText: 'Confirm'
						}).then((result)=>{
						if(result.value){
						data.time_desiredtime = moment(data.time_desiredtime,'HH:mm:ss').format('HH:mm:ss')
						$.post('/secretariat/transaction-facilityreservation/update',{
						dateRequested:data.date_eventdate,
						timeRequested:data.time_eventstart,
						eventstatus:$('#eventstatus').val(),
						eventid:$('#eventid').val(),
						reqid:$('#reqid').val(),
						reqstatus:$('#reqstatus').val(),
						payid:$('#payid').val(),
						paystatus:$('#paystatus').val()
						})
						.done(data=>{
							if(data){
								swal({
								title:'Success',
								text:'Status updated', 
								type:'success'
								}).then(function(){
									location.reload();
								})
								$('#updateModal').modal('hide');
								$('#updateAppend').empty();
							}
						})
						}
					})
					})
				})
			})
		})

								