extends ../../../../../templates/secretariat

block prepend main
    //- #wrap
    //- //- #calendar
    //- div(style='clear:both')
    .content
        .container-fluid
            .row
                .col-lg-12.col-md-12
                    // Tab panes
                    .tab-content
                        #nonwedding.tab-pane.active.mx-3
                            br
                            // Inner Nav tabs
                            ul.nav.nav-tabs
                                li.nav-item
                                    a.nav-link.active(data-toggle='tab', href='#regularbaptism') Regular Baptism
                                li.nav-item
                                    a.nav-link(data-toggle='tab', href='#specialbaptism') Special Bapitsm
                            // Tab panes
                            .tab-content
                                #regularbaptism.tab-pane.active
                                    br
                                    .card
                                            .card-header.card-header-primary
                                                    h4.card-title Regular Baptism
                                            .card-body.table-responsive
                                                    table.dataTable.table.table-hover
                                                            thead.text-primary
                                                                    th ID
                                                                    th Name of the Child
                                                                    th Birthday
                                                                    th Req Status
                                                                    th Payment Status
                                                                    th Approval Status
                                                                    th.text-center(style=" width:120px") Actions
                                                            tbody
                                                                    each regular in regulars
                                                                        tr
                                                                            td=regular.int_eventinfoID
                                                                            td=regular.var_lname + ", " + regular.var_fname
                                                                            td=regular.date_birthday
                                                                            td=regular.var_reqstatus
                                                                            td=regular.char_paymentstatus
                                                                            td=regular.char_approvalstatus
                                                                            td.td-actions.text-center
                                                                                button.btn.btn-primary.actionButton(type='button' value=`${regular.int_eventinfoID}`)
                                                                                    i.ti-settings
                                                                                        #toolbar-options.hidden
                                                                                            a.viewButton(href='#')
                                                                                                i.ti-new-window(style="color:white;")
                                                                                            a.updateButton(href='#')
                                                                                                i.ti-pencil(style="color:white;")
                                #specialbaptism.tab-pane.fade
                                    br
                                    .card
                                        .card-header.card-header-primary
                                            h4.card-title Special Baptism
                                        .card-body.table-responsive
                                            table.table.dataTable.table-hover
                                                thead.text-primary
                                                    th ID
                                                    th Name of the Child
                                                    th Birthday
                                                    th Desired Schedule
                                                    th Req Status
                                                    th Pymt Status
                                                    th Approval Status
                                                    th.text-right(style=" width:120px") Actions
                                                tbody
                                                    each special in specials
                                                        tr
                                                            td=special.int_eventinfoID
                                                            td=special.var_lname + ", " + special.var_fname
                                                            td=special.date_birthday
                                                            td=special.date_desireddate + ' ' + special.time_desiredtime
                                                            td=special.var_reqstatus
                                                            td=special.char_paymentstatus
                                                            td=special.char_approvalstatus
                                                            td.td-actions.text-center
                                                                button.btn.btn-primary.actionButton(type='button' value=`${special.int_eventinfoID}`)
                                                                    i.ti-settings
                                                                        #toolbar-options.hidden
                                                                            a.viewButton(href='#')
                                                                                i.ti-new-window(style="color:white;")
                                                                            a.updateButton(href='#')
                                                                                i.ti-pencil(style="color:white;")
    #updateModal.modal.fade(tabindex="-2" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true")
        .modal-dialog.modal-lg(role="document")
            .modal-content
                .modal-header
                    h5.modal-title Update Event Application
                    button.close(type='button', data-dismiss='modal', aria-label='Close')
                        span(aria-hidden='true') ×
                .modal-body#updateBodyAppend
                .modal-footer
                    button.btn.btn-outline.btn-secondary.pull-left#cancelButton(type='button', data-dismiss='modal') Close
                    button.btn.btn-primary#updateSubmitButton(type="button") Update
    #viewModal.modal.fade(tabindex="-2" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true")
            .modal-dialog.modal-lg(role="document")
                .modal-content
                    .modal-header
                        h5.modal-title Baptism
                        button.close(type='button', data-dismiss='modal', aria-label='Close')
                            span(aria-hidden='true') ×
                    .modal-body#viewBodyAppend
                    .modal-footer
                        button.btn.btn-outline.btn-secondary.pull-left#cancelButton(type='button', data-dismiss='modal') Close
    #myModal.modal(tabindex='-1', role='dialog', aria-labelledby='exampleModalLabel', aria-hidden='true')
        button.close(type='button', data-dismiss='modal', aria-label='Close')
            span(aria-hidden='true') ×
        img.modal-content1#imgReq
block addjs
    script.
        $(document).ready(function(){
            var idNow;
            $('.actionButton').click(function(){
                idNow = $(this).val();
                console.log(idNow)
            })
            $('.viewButton').click(function(){
                console.log(idNow)
                $.post('/secretariat/transaction-baptism/query',{id:idNow}).done(data =>{
                    var dateRequested = moment(data.date_desireddate).format('MM/DD/YYYY')
                    var timeRequested = moment(data.time_desiredtime,'HH:mm:ss').format('hh:mm A')
                    var age = moment().diff(data.date_birthday,'years');
                    $('#viewBodyAppend').append(`
                    <div class="form-group">
                        <label class="label-control"><strong> Name of the Child: </strong> ${data.var_mname}, ${data.var_fname}</label>
                    </div>
                    <div class="form-group">
                        <label class="label-control"> <strong> Desired Date: </strong> ${dateRequested}</label>
                    </div>
                    <div class="form-group">
                        <label class=" label-control"> <strong> Desired Time:  </strong> ${timeRequested}</label>
                    </div>
                    <div class="form-group">
                        <label class=" label-control"> <strong> Father's Name:  </strong> ${data.var_fathername}</label>
                    </div>
                    <div class="form-group">
                        <label class=" label-control"> <strong> Mother's Name:  </strong> ${data.var_mothername}</label>
                    </div>
                    <div class="form-group">
                        <label class=" label-control"> <strong> Age:  </strong> ${age}</label>
                    </div>
                    <div class="form-group">
                            <label class="label-control"> <strong> Requirements: </strong> ${data.var_reqname}</label>
                    </div>
                    <div class="form-group">
                        <img id="myImg" class="img-responsive" alt ="${data.var_reqname}" src="${data.var_reqpath}" style="max-height:250px;">
                    </div>
                    `)
                    $('#viewModal').modal('show')
                    $('#viewModal').on('hidden.bs.modal',function(){
                        $('#viewBodyAppend').empty()
                    })
                    $('#myImg').click(function(){
                        $('#myModal').modal('show');
                        $("#imgReq").attr("src",`${data.var_reqpath}`);
                    });

                })
            })
            $('.updateButton').click(function(){
                console.log(idNow)
                $.post('/secretariat/transaction-baptism/query/update',{id:idNow}).done(data =>{
                    $('#updateBodyAppend').append(`
                    <col-md-4 class="p-lg-0">
                        <div class="row">
                        <div class="col-md-6">
                            <div class="form-group">
                            <input id="eventid" type="hidden" value="${data.int_eventinfoID}"></input>
                            <input id="eventstatus" type="hidden" value="${data.char_approvalstatus}"></input>
                            <h6 class="label-control"><strong> Current Document Status : </strong> ${data.char_approvalstatus}</h6>
                        </div>
                        </div>
                        </div>
                        <div class="row">
                        <div class="col-md-6">
                            <div class="form-group">
                            <input id="reqid" type="hidden" value="${data.int_requirementID}"></input>
                            <h6 class="label-control"><strong> Current Requirement Status : </strong> ${data.var_reqstatus}</h6>
                            <select id="reqstatus" type="text">
                            </select>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group">
                            <input id="payid" type="hidden" value="${data.int_paymentID}"></input>
                            <h6 class="label-control"><strong> Current Payment Status: </strong> ${data.char_paymentstatus}</h6>
                            <select id="paystatus" type="text">
                            </select>
                            <div class="form-group">
                            <strong> Fee : </strong>P ${data.dbl_amount}.00
                            </div>
                            </div>
                        </div>
                        </div>
                        </div>
                    `)
                    $('#updateModal').modal('show')
                    $('#updateModal').on('hidden.bs.modal',function(){
                        $('#updateBodyAppend').empty()
                    })
                    if(data.char_paymentstatus == "Paid"){
                    $('#paystatus').append(`
                    <option selected="selected">Paid</option>
                    <option>Unpaid</option>
                    `)
                    }
                    else if(data.char_paymentstatus == "Unpaid"){
                    $('#paystatus').append(`
                    <option>Paid</option>
                    <option selected="selected">Unpaid</option>
                    `)
                    }
                    if(data.var_reqstatus == "Submitted"){
                    $('#reqstatus').append(`
                    <option selected="selected">Submitted</option>
                    <option>Approved</option>
                    `)
                    }
                    else if(data.var_reqstatus == "Approved"){
                    $('#reqstatus').append(`
                    <option>Submitted</option>
                    <option selected="selected">Approved</option>
                    `)
                    }
                    if(data.var_reqstatus == "Approved" && data.char_paymentstatus == "Paid"){
                        document.getElementById("paystatus").disabled=true;
                        document.getElementById("reqstatus").disabled=true;
                    }
                    $('#updateSubmitButton').click(function(){
                        swal({
                        title:'Are You Sure?', 
                        text:'You want to update the Status of the Request?', 
                        type:'warning',
                        showCancelButton: true,
                        confirmButtonColor: '#3085d6',
                        cancelButtonColor: '#d33',
                        confirmButtonText: 'Confirm'
                        }).then((result)=>{
                        if(result.value){
                        data.time_desiredtime = moment(data.time_desiredtime,'HH:mm:ss').format('HH:mm:ss')
                        $.post('/secretariat/transaction-baptism/update',{
                        dateRequested:data.date_desireddate,
                        timeRequested:data.time_desiredtime,
                        eventstatus:$('#eventstatus').val(),
                        eventid:$('#eventid').val(),
                        reqid:$('#reqid').val(),
                        reqstatus:$('#reqstatus').val(),
                        payid:$('#payid').val(),
                        paystatus:$('#paystatus').val()
                        })
                        .done(data=>{
                            if(data){
                                swal({
                                title:'Success',
                                text:'Status updated', 
                                type:'success'
                                }).then(function(){
                                    location.reload();
                                })
                                $('#updateModal').modal('hide');
                                $('#updateAppend').empty();
                            }
                        })
                        }
                    })
                    })
                })
            })
        })
