extends ../../../../../templates/secretariat
block prepend main
	style.
		body > div.mfp-wrap.mfp-close-btn-in.mfp-auto-cursor.mfp-with-zoom.mfp-ready > div {
			z-index: 9999 !important;
		}

		.mfp-with-zoom .mfp-container,
		.mfp-with-zoom.mfp-bg {
		opacity: 0;
		-webkit-backface-visibility: hidden;
		/* ideally, transition speed should match zoom duration */
		-webkit-transition: all 0.3s ease-out;
		-moz-transition: all 0.3s ease-out;
		-o-transition: all 0.3s ease-out;
		transition: all 0.3s ease-out;
		z-index: 99999;
		}

		.mfp-image, .mfp-container, .mfp-ready, .mfp-image-holder, .mfp-content, .mfp-preloader, .mfp-figure {
			z-index: 99999;
		}

		.mfp-with-zoom.mfp-ready .mfp-container {
			opacity: 1;
		}
		.mfp-with-zoom.mfp-ready.mfp-bg {
			opacity: 0.8;
		}

		.mfp-with-zoom.mfp-removing .mfp-container,
		.mfp-with-zoom.mfp-removing.mfp-bg {
		opacity: 0;
		}

		.size {
			width: 100px;
			height: 100px;
		}
	#wrap
	//- #calendar
	div(style='clear:both')
	.content
		.container-fluid
			.row
				.col-lg-12.col-md-12
					// Tab panes
					.tab-content
						#nonwedding.tab-pane.active.mx-3
							br
							// Inner Nav tabs
							
							// Tab panes
							.tab-content
								#marriage.tab-pane.active
									.card
											.card-header.card-header-primary(style='background:#367587; color:white')
													h4.card-title(style='background:#367587; color:white') Marriage Application
											.card-body.table-responsive
													table.table.table-hover.dataTable
															thead.text-primary
																	//- th ID
																	th Groom
																	th Bride
																	th Desired Schedule
																	th Date Applied
																	th Requirement Status
																	th Payment Status
																	th Approval Status
																	th.text-center Actions
															tbody
																	each marriage in marriages
																		tr
																			//- td=marriage.int_eventinfoID
																			td=marriage.var_lname + ", " + marriage.var_fname
																			td=marriage.var_blname + ", " + marriage.var_bfname
																			td=marriage.date_eventdate + ' ' + marriage.time_eventstart
																			td=marriage.date_applied
																			//- td=marriage.char_weddingtype
																			td
																				span.approvalreq(value=`${marriage.char_requirements}`) #{marriage.char_requirements}
																			td
																				span.approvalpay(value=`${marriage.char_paymentstatus}`) #{marriage.char_paymentstatus}
																			td
																				span.approval(value=`${marriage.char_approvalstatus}`) #{marriage.char_approvalstatus}
																			td.td-actions.text-center
																				button.btn.btn-primary.actionButton(type='button' value=`${marriage.int_eventinfoID}`)
																					i.ti-settings
																						#toolbar-options.hidden
																							a.viewButton(href='#')
																								i.ti-file(style="color:white;")
																							a.updateButton(href='#')
																								i.ti-pencil(style="color:white;")
																							a.updateReqButton(href='#')
																								i.ti-new-window(style="color:white;")



	#updateModal.modal.fade(tabindex="-2" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true")
		.modal-dialog.modal-lg(role="document")
			.modal-content
				.modal-header(style='background:#367587; color:white')
					h5.modal-title(style='background:#367587; color:white') Update Event Application
					button.close(type='button', data-dismiss='modal', aria-label='Close')
						span(aria-hidden='true' style='background:#367587; color:white') ×
				.modal-body#updateBodyAppend
				.modal-footer
					button.btn.btn-outline.btn-secondary.pull-left#cancelButton(type='button', data-dismiss='modal') Close
					button.btn.btn-primary#updateSubmitButton(type="button") Update
	#requirementModal.modal.fade(tabindex="-2" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true")
		.modal-dialog.modal-lg(role="document")
			.modal-content
				.modal-header(style='background:#367587; color:white')
					h5.modal-title(style='background:#367587; color:white') Update Requirements
					button.close(type='button', data-dismiss='modal', aria-label='Close')
						span(aria-hidden='true' style='background:#367587; color:white') ×
				.modal-body#requirementBodyAppend
				.modal-footer
					button.btn.btn-outline.btn-secondary.pull-left#cancelButton(type='button', data-dismiss='modal') Close
					button.btn.btn-primary#requirementSubmitButton(type="button") Update
	#viewModal.modal.fade(tabindex="-2" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true")
			.modal-dialog.modal-lg(role="document" style="z-index: 9998;")
				.modal-content
					.modal-header(style='background:#367587; color:white')
						h5.modal-title(style='background:#367587; color:white') Marriage
						button.close(type='button', data-dismiss='modal', aria-label='Close')
							span(aria-hidden='true' style='background:#367587; color:white') ×
					.modal-body#viewBodyAppend
					.modal-body    
						.form-group
							.gallery#reqAppend
					.modal-footer
						button.btn.btn-outline.btn-secondary.pull-left#cancelButton(type='button', data-dismiss='modal') Close
	#paymentModal.modal.fade(tabindex="-2" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true")
			.modal-dialog.modal-lg(role="document")
				.modal-content
					.modal-header(style='background:#367587')
						h5.modal-title(style='color:white') Update Payment Status
						button.close(type='button', data-dismiss='modal', aria-label='Close')
							span(aria-hidden='true' style='color:white') ×
					.modal-body#paymentAppend
					.modal-footer
						button.btn.btn-outline.btn-secondary.pull-left#cancellButton(type='button', data-dismiss='modal') Close
						button.btn#updatePayment(type="button" style='background:#367587; color:white') Update
	#messageModal.modal.fade(tabindex="-2" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true")
									.modal-dialog.modal-lg(role="document")
										.modal-content
											.modal-header(style='background:red')
												h5.modal-title(style='color:white') Message for the Guest
												button.close(type='button', data-dismiss='modal', aria-label='Close')
													span(aria-hidden='true' style='color:white') ×
											.modal-body#messageAppend
											.modal-footer
												//- button.btn.btn-outline.btn-secondary.pull-left#cancellButton(type='button', data-dismiss='modal') Close
												button.btn.btn-danger#sendMessage(type="button") Send

block addjs
	script.
		$(document).ready(function() {
			var ctr = 0;
			for(var i =0; i<= $('.approvalreq').length; i++){


				if($('.approvalreq').eq(i).attr('value') == "Submitted"){
					$('.approvalreq').eq(i).addClass('badge btn btn-primary-lg bgc-amber-100 c-amber-700')
				}
				else if($('.approvalreq').eq(i).attr('value') == "Complete"){
					$('.approvalreq').eq(i).addClass('badge btn btn-primary-lg bgc-green-100 c-green-700')
				}
				else if($('.approvalreq').eq(i).attr('value') == "Incomplete"){
					$('.approvalreq').eq(i).addClass('badge btn btn-primary-lg bgc-amber-100 c-amber-700')
				}
				if($('.approvalpay').eq(i).attr('value') == "Paid"){
					$('.approvalpay').eq(i).addClass('badge btn btn-primary-lg bgc-green-100 c-green-700')
				}
				else if($('.approvalpay').eq(i).attr('value') == "Unpaid"){
					$('.approvalpay').eq(i).addClass('badge btn btn-primary-lg bgc-amber-100 c-amber-700')
				}
				else if($('.approvalpay').eq(i).attr('value') == "Incomplete"){
					$('.approvalpay').eq(i).addClass('badge btn btn-primary-lg bgc-amber-50 c-amber-800')
				}
				if($('.approval').eq(i).attr('value') == "Pending"){
					$('.approval').eq(i).addClass('badge btn btn-primary-lg bgc-amber-100 c-amber-700')
				}
				else if($('.approval').eq(i).attr('value') == "Cancelled"){
					$('.approval').eq(i).addClass('badge btn btn-primary-lg bgc-red-100 c-red-700 ')
				}
				else if($('.approval').eq(i).attr('value') == "Approved"){
					$('.approval').eq(i).addClass('badge btn btn-primary-lg bgc-green-100 c-green-700')
				}
				else if($('.approval').eq(i).attr('value') == "Disapproved"){
					$('.approval').eq(i).addClass('badge btn btn-primary-lg bgc-red-100 c-red-700')
				}
			}
			$('.actionButton').click(function(){
				idNow = $(this).val();
				console.log(idNow)
			})
			$('.viewButton').click(function(){
				console.log(idNow)
				$.post('/secretariat/transaction-marriage/query',{id:idNow}).done(data =>{
					var dateRequested = moment(data.results.date_eventdate).format('MMMM DD, YYYY')
					var gbirthday = moment(data.results.date_birthday).format('MMMM DD, YYYY')
					var bbirthday = moment(data.results.date_bbirthday).format('MMMM DD, YYYY')
					var timeRequested = moment(data.results.time_eventstart,'HH:mm:ss').format('hh:mm A')
					var age = moment().diff(data.results.date_birthday,'years');
					$('#viewBodyAppend').append(`
					<div class="row">
						<div class="col-md-6">
							<h6 class="label-control">Desired Date:</h6>
							<input type="text" class="form-control" value="${dateRequested}" disabled> 
						</div>
						<div class="col-md-6">
							<h6 class="label-control"> Desired Time:</h6>
							<input type="text" class="form-control" value="${timeRequested}" disabled> 
						</div>
					</div>
					<h6>Groom</h6>
				
					<div class="row">
						<div class="col-md-12 px-lg-3 px-md-0 px-sm-0">
							<div class="form-group">
								<h6 class="label-control">Full Name</h6><input class="form-control" id="lastname" type="text" name="glastname" value= "${data.results.var_lname}, ${data.results.var_fname}" disabled/>
								<div class="help-block with-errors"></div>
							</div>
						</div>
					</div>

					<div class="row">
						<div class="col-md-4 px-lg-3 px-md-0 px-sm-0">
							<div class="form-group">
								<h6 class="label-control">Birthday:</h6><input class="form-control" type="text" name="gbirthday" value= ${gbirthday} disabled/>
								<div class="help-block with-errors"></div>
							</div>
						</div>
						<div class="col-md-8 p-lg-0 px-md-3 px-sm-0">
							<div class="form-group">
								<h6 class="label-control">Birthplace:</h6><input class="form-control" type="text" name="gbirthplace" value=${data.results.var_birthplace} disabled/>
								<div class="help-block with-errors"></div>
							</div>
						</div>
					</div>
					
					<div class="row">
						<div class="col-md-12 px-lg-3 px-md-0 px-sm-0">
							<div class="form-group">
								<h6 for="exampleFormControlTextarea1">Address:</h6><input class="form-control" rows="2" name="gaddress" value='${data.results.var_address}'disabled/>
								<div class="help-block with-errors"></div>
							</div>
						</div>
					</div>

					<div class="row">
						<div class="col-md-4 px-lg-3 px-md-0 px-sm-0 pl-sm-3 extra-small-balance">
							<div class="form-group">
								<h6 class="label-control">Civil Status:</h6><input class="form-control" type="text" name="gcivilstatus" value='${data.results.var_gcivilstatus}'disabled/>
								<div class="help-block with-errors"></div>
							</div>
						</div>
						<div class="col-md-4 px-lg-3 pr-md-3 px-sm-0">
							<div class="form-group">
								<h6 class="label-control">Occupation:</h6><input class="form-control" type="text" name="goccupation" value='${data.results.var_goccupation}'disabled/>
								<div class="help-block with-errors"></div>
							</div>
						</div>
						
						<div class="col-md-4 px-lg-3 px-md-0 px-sm-0">
							<div class="form-group">
								<h6 class="label-control">Nationality:</h6><input class="form-control" type="text" name="gnationality" value='${data.results.var_gnationality}'disabled/>
								<div class="help-block with-errors"></div>
							</div>
						</div>
					</div>
					
					<div class="row">
						<div class="col-md-4 px-lg-3 px-md-0 px-sm-0 pl-sm-3 extra-small-balance">
							<div class="form-group">
								<h6 class="label-control">Religion:</h6><input class="form-control" type="text" name="greligion" value='${data.results.var_greligion}'disabled/>
								<div class="help-block with-errors"></div>
							</div>
						</div>
						<div class="col-md-8 px-lg-3 pr-md-3 px-sm-0">
							<div class="form-group">
								<h6 class="label-control">Current Parish:</h6><input class="form-control" type="text" name="gcurrparish" value='${data.results.var_gcurrparish}'disabled/>
								<div class="help-block with-errors"></div>
							</div>
						</div>
						
					</div>
					<div class="row">
						<div class="col-md-4 px-lg-3 px-md-3 px-sm-3">
							<div class="form-group">
								<h6 class="label-control">Father's Full Name:</h6><input class="form-control" type="text" name="gfathername" value='${data.results.var_gfathername}'disabled/>
								<div class="help-block with-errors"></div>
							</div>
						</div>
						<div class="col-md-4 p-lg-0 px-md-3 px-sm-0">
							<div class="form-group">
								<h6 class="label-control">Father's Birthplace:</h6><input class="form-control" type="text" name="gfatherbplace" value='${data.results.var_gfatherbplace}'disabled/>
								<div class="help-block with-errors"></div>
							</div>
						</div>
						<div class="col-md-4 px-lg-3 px-md-0 px-sm-0">
							<div class="form-group">
								<h6 class="label-control">Father's Religion:</h6><input class="form-control" type="text" name="gfatherreligion" value='${data.results.var_gfatherreligion}'disabled/>
								<div class="help-block with-errors"></div>
							</div>
						</div>
					</div>
					<div class="row">
						<div class="col-md-4 px-lg-3 px-md-0 px-sm-0">
							<div class="form-group">
								<h6 class="label-control">Mother's Full Name:</h6><input class="form-control" type="text" name="gmothername" value='${data.results.var_gmothername}'disabled/>
								<div class="help-block with-errors"></div>
							</div>
						</div>
						<div class="col-md-4 p-lg-0 px-md-3 px-sm-0">
							<div class="form-group">
								<h6 class="label-control">Mother's Birthplace:</h6><input class="form-control" type="text" name="gmotherbplace" value='${data.results.var_gmotherbplace}'disabled/>
								<div class="help-block with-errors"></div>
							</div>
						</div>
						<div class="col-md-4 px-lg-3 px-md-0 px-sm-0">
							<div class="form-group">
								<h6 class="label-control">Mother's Religion:</h6><input class="form-control" type="text" name="gmotherreligion" value='${data.results.var_gmotherreligion}'disabled/>
								<div class="help-block with-errors"></div>
							</div>
						</div>
					</div>



					<hr>
					<h6>Bride</h6>
				
					<div class="row">
						<div class="col-md-12 px-lg-3 px-md-0 px-sm-0">
							<div class="form-group">
								<h6 class="label-control">Full Name</h6><input class="form-control" id="lastname" type="text" name="blastname" value= "${data.results.var_blname}, ${data.results.var_bfname}" disabled/>
								<div class="help-block with-errors"></div>
							</div>
						</div>
					</div>

					<div class="row">
						<div class="col-md-4 px-lg-3 px-md-0 px-sm-0">
							<div class="form-group">
								<h6 class="label-control">Birthday:</h6><input class="form-control" type="text" name="bbirthday" value= ${bbirthday} disabled/>
								<div class="help-block with-errors"></div>
							</div>
						</div>
						<div class="col-md-8 p-lg-0 px-md-3 px-sm-0">
							<div class="form-group">
								<h6 class="label-control">Birthplace:</h6><input class="form-control" type="text" name="bbirthplace" value=${data.results.var_bbirthplace} disabled/>
								<div class="help-block with-errors"></div>
							</div>
						</div>
					</div>
					
					<div class="row">
						<div class="col-md-12 px-lg-3 px-md-0 px-sm-0">
							<div class="form-group">
								<h6 for="exampleFormControlTextarea1">Address:</h6><input class="form-control" rows="2" name="baddress" value='${data.results.var_baddress}'disabled/>
								<div class="help-block with-errors"></div>
							</div>
						</div>
					</div>

					<div class="row">
						<div class="col-md-4 px-lg-3 px-md-0 px-sm-0 pl-sm-3 extra-small-balance">
							<div class="form-group">
								<h6 class="label-control">Civil Status:</h6><input class="form-control" type="text" name="bcivilstatus" value='${data.results.var_bcivilstatus}'disabled/>
								<div class="help-block with-errors"></div>
							</div>
						</div>
						<div class="col-md-4 px-lg-3 pr-md-3 px-sm-0">
							<div class="form-group">
								<h6 class="label-control">Occupation:</h6><input class="form-control" type="text" name="boccupation" value='${data.results.var_boccupation}'disabled/>
								<div class="help-block with-errors"></div>
							</div>
						</div>
						
						<div class="col-md-4 px-lg-3 px-md-0 px-sm-0">
							<div class="form-group">
								<h6 class="label-control">Nationality:</h6><input class="form-control" type="text" name="bnationality" value='${data.results.var_bnationality}'disabled/>
								<div class="help-block with-errors"></div>
							</div>
						</div>
					</div>
					
					<div class="row">
						<div class="col-md-4 px-lg-3 px-md-0 px-sm-0 pl-sm-3 extra-small-balance">
							<div class="form-group">
								<h6 class="label-control">Religion:</h6><input class="form-control" type="text" name="breligion" value='${data.results.var_breligion}'disabled/>
								<div class="help-block with-errors"></div>
							</div>
						</div>
						<div class="col-md-8 px-lg-3 pr-md-3 px-sm-0">
							<div class="form-group">
								<h6 class="label-control">Current Parish:</h6><input class="form-control" type="text" name="bcurrparish" value='${data.results.var_bcurrparish}'disabled/>
								<div class="help-block with-errors"></div>
							</div>
						</div>
						
					</div>
					<div class="row">
						<div class="col-md-4 px-lg-3 px-md-3 px-sm-3">
							<div class="form-group">
								<h6 class="label-control">Father's Full Name:</h6><input class="form-control" type="text" name="bfathername" value='${data.results.var_bfathername}'disabled/>
								<div class="help-block with-errors"></div>
							</div>
						</div>
						<div class="col-md-4 p-lg-0 px-md-3 px-sm-0">
							<div class="form-group">
								<h6 class="label-control">Father's Birthplace:</h6><input class="form-control" type="text" name="bfatherbplace" value='${data.results.var_bfatherbplace}'disabled/>
								<div class="help-block with-errors"></div>
							</div>
						</div>
						<div class="col-md-4 px-lg-3 px-md-0 px-sm-0">
							<div class="form-group">
								<h6 class="label-control">Father's Religion:</h6><input class="form-control" type="text" name="bfatherreligion" value='${data.results.var_bfatherreligion}'disabled/>
								<div class="help-block with-errors"></div>
							</div>
						</div>
					</div>
					<div class="row">
						<div class="col-md-4 px-lg-3 px-md-0 px-sm-0">
							<div class="form-group">
								<h6 class="label-control">Mother's Full Name:</h6><input class="form-control" type="text" name="bmothername" value='${data.results.var_bmothername}'disabled/>
								<div class="help-block with-errors"></div>
							</div>
						</div>
						<div class="col-md-4 p-lg-0 px-md-3 px-sm-0">
							<div class="form-group">
								<h6 class="label-control">Mother's Birthplace:</h6><input class="form-control" type="text" name="bmotherbplace" value='${data.results.var_bmotherbplace}'disabled/>
								<div class="help-block with-errors"></div>
							</div>
						</div>
						<div class="col-md-4 px-lg-3 px-md-0 px-sm-0">
							<div class="form-group">
								<h6 class="label-control">Mother's Religion:</h6><input class="form-control" type="text" name="bmotherreligion" value='${data.results.var_bmotherreligion}'disabled/>
								<div class="help-block with-errors"></div>
							</div>
						</div>
					</div>
					`)
					console.log(data.requirements)
					//- for(i=0;i<data.requirements.length;i++){
					//- $(`#reqAppend`).append(`
					//- 	<a class="image-link" href="${data.requirements[i].var_reqpath}" title="${data.requirements[i].var_reqname}"><img class="size" src="${data.requirements[i].var_reqpath}"/></a>
					//- `)
					//- }
					$('#viewModal').modal('show')
					$('#viewModal').on('hidden.bs.modal',function(){
						$('#viewBodyAppend').empty()
						$('#reqAppend').empty()
					})

				})
			})
			//requirements
			$('.updateReqButton').click(function(){
				console.log(idNow)
				$.post('/secretariat/transaction-marriage/query/update',{id:idNow}).done(data =>{
				console.log(data.casestext)
					//- console.log(data.submitted)

					
					$('#requirementBodyAppend').append(`
					
					<col-md-12 class="p-lg-0">
						<div class="row">
							<div class="col-md-12">
								<div class="form-group">
									<input id="eventid" type="hidden" value="${data.results.int_eventinfoID}"></input>
									<input id="eventstatus" type="hidden" value="${data.results.char_approvalstatus}"></input>

									<h6 class="label-control"><strong>Initial Requirements</h6>
								</div>
							</div>
						</div>
						
						
					`)
					for(i=0;i<data.submitted.length;i++){
					$(`#requirementBodyAppend`).append(`
						<a class="image-link" href="${data.submitted[i].var_reqpath}" title="${data.submitted[i].var_reqname}"><img class="size" src="${data.submitted[i].var_reqpath}"/></a>
					`)
					}
					$('#requirementBodyAppend').append(`
						<div class="row">
							<div class="col-md-6">
								<br><label class="label-control"><strong>Folder Location: </label></strong> ${data.results.var_folderloc}
								<h6 class="label-control"><strong>Requirements: </strong></h6>
								<div class="form-group" id="reqAppend"></div>		
								
							</div>
							<div class="col-md-6">
								<br><h6 class="label-control"><strong>Case(s): </strong></h6>
								<div class="form-group" id="caseAppend"></div>	
							</div>
						</div>
						
					`)
					//- <h6 class="label-control"><strong>Files Location: </strong></h6>
						//- <div class="row">
						//- 	<div class="col-md-2">
						//- 		<div class="form-group">
						//- 			<label>Cabinet
						//- 			<input type="text" class='form-control' id='cabinet'><br>
						//- 		</div>	
						//- 	</div>
						//- 	<div class="col-md-2">
						//- 		<div class="form-group">
						//- 			<label>Drawer
						//- 			<input type="text" class='form-control' id='drawer'><br>
						//- 		</div>	
						//- 	</div>
						//- 	<div class="col-md-2">
						//- 		<div class="form-group">
						//- 			<label>Folder
						//- 			<input type="text" class='form-control' id='folder'><br>
						//- 		</div>	
						//- 	</div>
						//- </div>
					//- <table style ="width: 100%">
					//- 				<tr>
					//- 					<th><label>Service Fee:
					//- 					<td><input type="text" class='form-control'><br>
					//- 				</tr>
					//- 				<tr>
					//- 					<th>Additional Fee:
					//- 					<td><input type="text" class='form-control'><br>
					//- 				</tr>
					//- 				<tr>
					//- 					<th>TOTAL AMOUNT:
					//- 					<td><strong><input type="text" class='form-control'><br></strong>
					//- 				</tr>
					//- 			</table>
					for(i=0;i<data.casestext.length;i++){
						$(`#caseAppend`).append(`
							<li>${data.casestext[i]}  </li>
						`)
					}

					for(i=0;i<data.requirements.length;i++){
					
						if(data.requirements[i].var_reqstatus != "Approved"){
							$(`#reqAppend`).append(`
							<input type="checkbox"  class="checkbox" value=${data.requirements[i].int_requirementID}>${data.requirements[i].var_reqname}  <br>
							`)
						}
						
						else if(data.requirements[i].var_reqstatus == "Approved"){
							$(`#reqAppend`).append(`
							<input type="checkbox" disabled=true checked="" class="checkbox" value=${data.requirements[i].int_requirementID}>${data.requirements[i].var_reqname} <br> 
							`) 
						}
					}
					$('#requirementModal').modal('show')
					$('#requirementModal').on('hidden.bs.modal',function(){
						$('#requirementBodyAppend').empty()
					})
					
					$('#requirementSubmitButton').click(function(){
						
						swal({
							title:'Are you sure?', 
							text:'You want to update the requirements?', 
							type:'warning',
							showCancelButton: true,
							confirmButtonColor: '#3085d6',
							cancelButtonColor: '#d33',
							confirmButtonText: 'Confirm'
						}).then((result)=>{
							if(result.value){
								
								for(i=0;i<$('.checkbox').length;i++){
									if($('.checkbox')[i].checked == true){
										$.post('/secretariat/transaction-marriage/updateRequirements',{
										id:$('.checkbox')[i].getAttribute('value')
										}).done(data=>{
											if(data){
												swal({
												title:'Success',
												text:'Status updated', 
												type:'success'
												}).then(function(){
													location.reload();
												})
												$('#updateModal').modal('hide');
												$('#updateAppend').empty();
											}
										})
										}
								}
								if($('.checkbox:checked').length == $('.checkbox').length){
									$.post('/secretariat/transaction-marriage/updateRequirementStatus',{
										id:$('#eventid').val()
										}).done(data=>{
											if(data){
												swal({
												title:'Success',
												text:'Requirements Complete', 
												type:'success'
												}).then(function(){
													location.reload();
												})
												$('#updateModal').modal('hide');
												$('#updateAppend').empty();
											}
										})
								}
							data.time_eventstart = moment(data.time_eventstart,'HH:mm:ss').format('HH:mm:ss')
							var fileloc= $('#cabinet').val()+$('#drawer').val()+$('#folder').val()
							$.post('/secretariat/transaction-marriage/update',{id:idNow,fileloc:fileloc})
							.done(data=>{
								if(data){
									swal({
									title:'Success',
									text:'Status updated', 
									type:'success'
									}).then(function(){
										location.reload();
									})
									$('#updateModal').modal('hide');
									$('#updateAppend').empty();
								}
							})
							}
					})
					})
				})
			})
			//update requirements
			$('.updateButton').click(function(){
				console.log(idNow)
				$.post('/secretariat/transaction-marriage/paymentquery',{id1:idNow})
							.done(data =>{
								var dateapplied = moment(data.date_applied).format('MMMM DD, YYYY')
								var scheduledate = moment(data.date_eventdate).format('MMMM DD, YYYY')
								var scheduletime = moment(data.time_eventstart, 'hh:mm:ss').format('hh:mm A')
								var downpaymentdeadline = moment(data.date_downpaymentdeadline).format('MMMM DD, YYYY')
								var fullpaymentdeadline = moment(data.date_fullpaymentdeadline).format('MMMM DD, YYYY')
								var nowDate = new Date(); 
								var date = nowDate.getFullYear()+'/'+(nowDate.getMonth()+1)+'/'+nowDate.getDate() +" "+ nowDate.getHours() +":" + nowDate.getMinutes() +":" +nowDate.getSeconds(); 
								console.log(data)
								var additionalfee =data.dbl_amount-data.double_fee
								var strdownpayment= "0." + data.int_downpaymentpercent
								var downpayment= data.dbl_amount*parseFloat(strdownpayment)
								var fullpayment= data.dbl_amount
								
								$('#paymentAppend').append(`
										
										<div class="send-header">
											
											<div class="row">
												<div class="col-md-6">
													<div class="form-group">
														<label class="label-control"><strong> Couple: </strong> Mr. ${data.var_lname} and Ms. ${data.var_blname} </label>
														<label class="label-control"><strong> Applied by: </strong> ${data.var_userlname}, ${data.var_userfname} </label>
														<br><label class="label-control"><strong>Tentative Schedule: </strong> ${scheduledate} - ${scheduletime} </label>
														
													</div>
												</div>
												<div class="col-md-6">
													<div class="form-group">	
														<label class="label-control"><strong> Voucher Code: </strong> ${data.var_vouchercode}</label>
														<br><label class="label-control"><strong> Date Appplied: </strong> ${dateapplied}</label>
														<br><label class="label-control"><strong> Payment Status</strong> ${data.char_paymentstatus}</label>
														
													</div>
												</div>
											</div>
												
											<hr>
											<div class="row">
												
												<div class="col-md-6">
													<div class="form-group">
															<label class="label-control"><strong>Expected Downpayment: </label></strong> ${downpayment}
															<br><label class="label-control"><strong>Full payment: </label></strong> ${fullpayment}
													</div>
												</div>
												
												<div class="col-md-6">
													<div class="form-group">
														<label class="label-control"><strong>Downpayment Deadline:</strong></label> ${downpaymentdeadline}
														<br><label class="label-control"><strong>Fullpayment Deadline:</strong></label> ${downpaymentdeadline}
													</div>
												</div>
											</div>
											<hr>
											<div class="row">
												<div class="col-md-6">
													<div class="form-group">
														<table style ="width: 100%">
															<tr>
																<th>Service Fee:
																<td style ="text-align: right">${data.dbl_amount}
															</tr>
															<tr>
																<th>Additional Fee:
																<td style ="text-align: right">${additionalfee}
															</tr>
															<tr>
																<th>TOTAL AMOUNT:
																<td style ="text-align: right"><strong>${data.dbl_amount}</strong>
															</tr>
															
														</table>
													
													</div>
												</div>
												<div class="col-md-6">
													<div class="row">
														<div class="col-md-5">
															<label class="label-control"><strong>Remaining Balance:</label></strong>															
														</div>
														<div class="col-md-7" style="text-align: right; color: red;">
															${data.dbl_balance}.00
														</div>
													</div>
													<div class="row">
														<div class="col-md-5">
															<label class="label-control"><strong>Payment Received</label></strong>															
														</div>
														<div  class="col-md-7">
															<input type='number' id="payment" class="form-control" placeholder="0.00"  style="text-align: right">
														</div>
													</div>
												</div>

										
										<div id="compose-area"></div>
									
									`)
									
									//- <div class="form-group">
									//- 	<input id="payid" type="hidden" value="${data.int_paymentID}"></input>
									//- 	<h6 class="label-control"><strong>Current Payment Status: </strong></h6>
									//- 	<select id="paystatus" onchange='payment(${data.int_eventinfoID});' type="text">
									//- 	</select>
									//- </div>
									//Payment
									if(data.char_paymentstatus == "Paid"){
										$('#paystatus').append(`
											<option selected="selected">Paid</option>
										`)
											$("#paystatus").prop('disabled', true);
									}
									else if(data.char_paymentstatus == "Unpaid"){
										$('#paystatus').append(`
											<option>Paid</option>
											<option selected="selected" disabled>Unpaid</option>
										`)
									}
									$('#paymentModal').modal('show')
									$('#paymentModal').on('hidden.bs.modal',function(){
										$('#selectBox').val('default')
										$('#paymentAppend').empty()
									})
									
									$('#updatePayment').click(function(){
										swal({
										title:'Are you sure?', 
										text:'You will not be able to revert this.', 
										type:'warning',
										showCancelButton: false,
										confirmButtonColor: '#3085d6',
										cancelButtonColor: '#d33',
										confirmButtonText: 'Confirm'
										}).then((result)=>{
											if(result.value){										
												var payment= $('#payment').val()
												$.post('/secretariat/transaction-marriage/changepaymentstatus',{id1:idNow, payment:payment, status:"Paid"})
													.done(data =>{
														if(data.balance==0){
															swal({
																title:'Success',
																text:'No more remaining balance!!', 
																type:'success'
															}).then(function(){
																location.reload()
															})
														}
														else{
															swal({
																title:'Success',
																html:`Payment status updated! 
																<br>The guest has a remaining balance of <strong>${data.balance}<strong>`, 
																type:'success'
															}).then(function(){
																location.reload()
															})	
														}
											})
											$('#paymentModal').modal('hide');
											$('#paymentAppend').empty();

													
											}
									})
									})

							})
			})
			
		});
		function payment($i) {
			//- alert($i);
				//- var value = value.split(',');
				//- console.log(value)
				
			swal({
					title: 'Are you sure change status?',
					text: "",
					type: 'warning',
					showCancelButton: true,
					confirmButtonColor: '#3085d6',
					cancelButtonColor: '#d33',
					confirmButtonText: 'Confirm'
					}).then((result) => {
						if (result.value) {
							$.post('/secretariat/transaction-marriage/paymentquery',{id1:$i})
							.done(data =>{
								var dateapplied = moment(data.date_applied).format('MMMM DD, YYYY')
								var nowDate = new Date(); 
								var date = nowDate.getFullYear()+'/'+(nowDate.getMonth()+1)+'/'+nowDate.getDate() +" "+ nowDate.getHours() +":" + nowDate.getMinutes() +":" +nowDate.getSeconds(); 
								console.log(data)
								$('#paymentAppend').append(`
										
										<div class="send-header">
											<div class="row">
												<div class="col-md-6">
													<div class="form-group">
														<label class="label-control"><strong> Guest's Name: </strong> ${data.var_userlname}, ${data.var_userfname} </label>
														<br><label class="label-control"><strong> Address: </strong> ${data.var_useraddress}</label>
														<br><label class="label-control"><strong>Service Name:</strong> ${data.var_eventname}</label>
													</div>
												</div>
												<div class="col-md-6">
													<div class="form-group">	
														<label class="label-control"><strong> Voucher ID: </strong> ${data.var_vouchercode}</label>
														<br><label class="label-control"><strong> Date Appplied: </strong> ${dateapplied}</label>
														<br><label class="label-control"><strong> Date Received:</strong> ${date}</label>
													</div>
												</div>
											</div>
												
											<div class="row">
												
											</div>
											<div class="row">
												<div class="col-md-6">
													<div class="form-group">
														
														<label class="label-control"><strong>Service Fee:</strong> ${data.dbl_amount}</label>
														<br><label class="label-control"><strong>Total Amount:</strong></label>
														<h5 style='color:red; float: right'>P${data.dbl_amount} </h5>
														
													</div>
												</div>
												<div class="col-md-6">
													<div class="form-group mt-1">
													<label class="label-control">Payment Received</label>
													<input type='number' id="payment" class="timepicker1 form-control">
													</div>
												</div>
											</div>
											
										</div>
										<div id="compose-area"></div>
									`)
									$('#paymentModal').modal('show')
									$('#paymentModal').on('hidden.bs.modal',function(){
										$('#selectBox').val('default')
										$('#paymentAppend').empty()
									})
									
									$('#updatePayment').click(function(){
										swal({
										title:'Are you sure?', 
										text:'You will not be able to revert this. ', 
										type:'warning',
										showCancelButton: false,
										confirmButtonColor: '#3085d6',
										cancelButtonColor: '#d33',
										confirmButtonText: 'Confirm'
										}).then((result)=>{
											if(result.value){										
												var payment= $('#payment').val()
												$.post('/secretariat/transaction-marriage/changepaymentstatus',{id1:idNow, payment:payment, status:"Paid"})
													.done(data =>{
														swal({
															title:'Success',
															text:'Payment status updates!', 
															type:'success'
														}).then(function(){
															location.reload()
														})	
											})
											$('#paymentModal').modal('hide');
											$('#paymentAppend').empty();

													
											}
									})
									})

							})
						}
					})
		}
		function approval($i) {
			console.log(this)
			var split = $i.split(',')
			console.log(split)
			swal({
					title: 'Are you sure change status?',
					text: "",
					type: 'warning',
					showCancelButton: true,
					confirmButtonColor: '#3085d6',
					cancelButtonColor: '#d33',
					confirmButtonText: 'Confirm'
					}).then((result) => {
						if (result.value) {
							if(split[1]!=0){
								$.post('/secretariat/transaction-marriage/changeapprovalstatus',{id1:split[0], status:split[1]})
								.done(data =>{
									
										swal({
										title:'Success',
										text:'Status changed',
										icon:'success'
										}).then(function(){
											location.reload();
										})
									
								})
							}
						else if(split[1]==0){
										$.post('/secretariat/message',{int_userID:$('#int_userID').val()})
										.done(data =>{
											
											$('#messageAppend').append(`
											<h4 class="c-grey-900 mB-20">Send Message</h4>
												<div class="send-header">
													<div class="form-group">
													<input type="hidden" class='form-control' id='int_receiverID' placeholder="To" value =" ${data.int_userID}">
													<input type="text" class='form-control' placeholder="To" value ="${data.var_userlname}, ${data.var_userfname}">
													</div>
													<div class="form-group">
													<input class="form-control" id='var_subject' value='Disapproval of application'>
													</div>
													<div class="form-group">
													<textarea name="compose" class="form-control" id='text_message' placeholder="Please state your reason why you disapproved the guest's application." rows='6'></textarea>
													</div>
												</div>
												<div id="compose-area"></div>
											`)
											$('#messageModal').modal('show')
											$('#messageModal').on('hidden.bs.modal',function(){
												$('#selectBox').val('default')
												$('#messageAppend').empty()
											})
											
											$('#sendMessage').click(function(){
												swal({
												title:'Are you sure?', 
												text:'This message will be sent to the guest and his/her application will be disapproved. Temporarily, we will hold the transaction until you approve their submitted requirements to the office.', 
												type:'warning',
												showCancelButton: false,
												confirmButtonColor: '#3085d6',
												cancelButtonColor: '#d33',
												confirmButtonText: 'Confirm'
												}).then((result)=>{
													if(result.value){										
														$.post('/secretariat/message/send',{
															int_receiverID:$('#int_receiverID').val(),
															int_receiverID:$('#int_receiverID').val(),
															var_subject:$('#var_subject').val(),
															text_message:$('#text_message').val(),
															id1:$i
														})
														.done(data=>{
															if(data){
																	
																swal({
																	title:'Success',
																	text:'Status updated and message sent!', 
																	type:'success'
																}).then(function(){
																	$.post('/secretariat/transaction-marriage/changeapprovalstatus',{id1:split[0], status:split[1]})
																		.done(data =>{
																			location.reload()
																		})	
																})
																$('#messageModal').modal('hide');
																$('#messageAppend').empty();
															}
														})
													}
											})
											})
										})
									}
								
							}
						})
		}